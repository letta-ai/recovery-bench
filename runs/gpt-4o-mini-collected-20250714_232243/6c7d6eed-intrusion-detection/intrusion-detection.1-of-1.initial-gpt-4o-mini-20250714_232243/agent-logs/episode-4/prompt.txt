root@c59a29921454:/app# echo '  done < <(cat "$LOGS_DIR/auth.log" "$LOGS_DIR/http.log")' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  # Generate alert.json and report.json using the collected data' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  echo "{" > "$ALERT_FILE"' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  echo "  \"timestamp\": \"$timestamp\",\"alerts\": [\" >> "$ALERT_FILE"' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  # Logic to append alerts to alert.json' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  echo "  ]}" >> "$ALERT_FILE"' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  # Similar logic for report.json' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '}' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  # Read detection rules from the rules file' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  local rules=$(cat "$RULES_FILE")' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  while IFS= read -r line; do' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '    # Check line against each rule and update matches and statistics' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '    for rule in $(echo "$rules" | jq -c ".[]"); do' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '      # Extract rule details' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '      local rule_id=$(echo "$rule" | jq -r ".id")' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '      # Match the line with the rule' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '      if [[ "$line" =~ $(echo "$rule" | jq -r ".pattern") ]]; then' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '        matches=$((matches + 1))' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '        ips+="$(echo "$line" | jq -r ".ip") "' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '        statistics["$rule_id"]=$((statistics["$rule_id"] + 1))' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '      fi' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '    done' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  done < <(cat "$LOGS_DIR/auth.log" "$LOGS_DIR/http.log")' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  # Prepare to write alerts and report' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  local unique_ips=$(echo "$ips" | tr " " "\n" | sort -u | tr "\n" ",")' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  echo "{\"timestamp\": \"$timestamp\", \"alerts\": [" > "$ALERT_FILE"' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  for rule_id in "${!statistics[@]}"; do' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '    echo "  {\"id\": \"$rule_id\", \"severity\": \"$(echo "$rule" | jq -r ".severity")\", \"matches\": ${statistics[$rule_id]}, \"
ips\": \"$unique_ips\"}," >> "$ALERT_FILE"' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  done' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  echo "  ]}" >> "$ALERT_FILE"' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  # Generate report.json similarly' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  echo "{\"timestamp\": \"$timestamp\", \"events\": [" > "$REPORT_FILE"' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  for rule_id in "${!statistics[@]}"; do' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '    echo "  {\"id\": \"$rule_id\", \"severity\": \"$(echo "$rule" | jq -r ".severity")\", \"matches\": ${statistics[$rule_id]}, \"
ips\": \"$unique_ips\"}," >> "$REPORT_FILE"' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  done' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  echo "  ]}" >> "$REPORT_FILE"' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '}' >> /app/intrusion_detector.sh
root@c59a29921454:/app#
