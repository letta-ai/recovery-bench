root@c59a29921454:/app# echo '      # Extract rule details' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '      local rule_id=$(echo "$rule" | jq -r ".id")' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '      # Match the line with the rule' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '      if [[ "$line" =~ $(echo "$rule" | jq -r ".pattern") ]]; then' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '        matches=$((matches + 1))' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '        ips+="$(echo "$line" | jq -r ".ip") "' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '        statistics["$rule_id"]=$((statistics["$rule_id"] + 1))' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '      fi' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '    done' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  done < <(cat "$LOGS_DIR/auth.log" "$LOGS_DIR/http.log")' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  # Prepare to write alerts and report' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  local unique_ips=$(echo "$ips" | tr " " "\n" | sort -u | tr "\n" ",")' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  echo "{\"timestamp\": \"$timestamp\", \"alerts\": [" > "$ALERT_FILE"' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  for rule_id in "${!statistics[@]}"; do' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '    echo "  {\"id\": \"$rule_id\", \"severity\": \"$(echo "$rule" | jq -r ".severity")\", \"matches\": ${statistics[$rule_id]}, \"
ips\": \"$unique_ips\"}," >> "$ALERT_FILE"' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  done' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  echo "  ]}" >> "$ALERT_FILE"' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  # Generate report.json similarly' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  echo "{\"timestamp\": \"$timestamp\", \"events\": [" > "$REPORT_FILE"' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  for rule_id in "${!statistics[@]}"; do' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '    echo "  {\"id\": \"$rule_id\", \"severity\": \"$(echo "$rule" | jq -r ".severity")\", \"matches\": ${statistics[$rule_id]}, \"
ips\": \"$unique_ips\"}," >> "$REPORT_FILE"' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  done' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '  echo "  ]}" >> "$REPORT_FILE"' >> /app/intrusion_detector.sh
root@c59a29921454:/app# echo '}' >> /app/intrusion_detector.sh
root@c59a29921454:/app# /app/intrusion_detector.sh; tmux wait -S done
/app/intrusion_detector.sh: line 8: syntax error near unexpected token `}'
/app/intrusion_detector.sh: line 8: `}'
root@c59a29921454:/app# echo 'Testing the response.sh script with a valid IP...'
Testing the response.sh script with a valid IP...
root@c59a29921454:/app# /app/response.sh 192.168.1.1; tmux wait -S done
Generating block rule for IP: 192.168.1.1
Extracting activity for IP: 192.168.1.1 from logs
Creating incident report for IP: 192.168.1.1
root@c59a29921454:/app# echo 'Testing the response.sh script with an invalid IP...'
Testing the response.sh script with an invalid IP...
root@c59a29921454:/app# /app/response.sh; tmux wait -S done
invalid
root@c59a29921454:/app#
