['asciinema rec --stdin /logs/agent.cast', 'Enter']
['clear', 'Enter']
'apt-get update\n'
'apt-get install -y git nginx openssl\n'
'mkdir -p /git/project && cd /git/project && git init --bare\n'
"echo 'password' | chpasswd\n"
"echo 'Match User git\n    PasswordAuthentication yes\n' >> /etc/ssh/sshd_config\n"
'systemctl restart ssh\n'
"openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/nginx-selfsigned.key -out /etc/ssl/certs/nginx-selfsigned.crt -subj '/CN=localhost'\n"
"echo 'server { listen 8443 ssl; server_name localhost; ssl_certificate /etc/ssl/certs/nginx-selfsigned.crt; ssl_certificate_key /etc/ssl/private/nginx-selfsigned.key; location / { root /git/project/main; index index.html; } location /dev/ { root /git/project/dev; index index.html; } }' > /etc/nginx/sites-available/default\n"
'systemctl restart nginx\n'
'echo \'#!/bin/bash\nGIT_REPO_PATH=/git/project\nTARGET_DIR=$GIT_REPO_PATH/\nBRANCH_NAME=$(git rev-parse --abbrev-ref HEAD)\nif [ "$BRANCH_NAME" == "main" ]; then\n  cp -r $TARGET_DIR/main/* /var/www/html/;\nelif [ "$BRANCH_NAME" == "dev" ]; then\n  cp -r $TARGET_DIR/dev/* /var/www/html/dev/;\nfi\' > /git/project/hooks/post-receive\n'
'chmod +x /git/project/hooks/post-receive\n'
'apt-get install -y lighttpd\n'
'lighttpd -f /etc/lighttpd/lighttpd.conf\n'
'curl -k https://localhost:8443\n'
'cat /etc/lighttpd/lighttpd.conf\n'
'lighttpd -D -f /etc/lighttpd/lighttpd.conf\n'
"sed -i 's/server.port = 80/server.port = 8443/' /etc/lighttpd/lighttpd.conf\n"
'echo \'server.modules += ( "mod_openssl" )\nssl.engine = "enable"\nssl.pemfile = "/etc/ssl/certs/nginx-selfsigned.crt"\n\' >> /etc/lighttpd/lighttpd.conf\n'
'lighttpd -D -f /etc/lighttpd/lighttpd.conf\n'
'lsof -i :80\n'
'kill $(lsof -t -i:80)\n'
'lighttpd -D -f /etc/lighttpd/lighttpd.conf\n'
'ls -l /etc/ssl/certs/nginx-selfsigned.crt\n'
'openssl rsa -in /etc/ssl/private/nginx-selfsigned.key -out /etc/ssl/private/nginx-selfsigned.key.new\n'
'cat /etc/ssl/certs/nginx-selfsigned.crt /etc/ssl/private/nginx-selfsigned.key.new > /etc/ssl/certs/lighttpd-selfsigned.pem\n'
'sed -i \'s|ssl.pemfile = "/etc/ssl/certs/nginx-selfsigned.crt"|ssl.pemfile = "/etc/ssl/certs/lighttpd-selfsigned.pem"|\' /etc/lighttpd/lighttpd.conf\n'
'lighttpd -D -f /etc/lighttpd/lighttpd.conf\n'
'lighttpd -D -f /etc/lighttpd/lighttpd.conf\n'
'curl -k https://localhost:8443\n'
"netstat -tuln | grep ':80'\n"
"kill -9 $(netstat -tuln | grep ':80' | awk '{print $7}' | cut -d'/' -f1)\n"
'lighttpd -D -f /etc/lighttpd/lighttpd.conf\n'
"ps aux | grep ':80'\n"
'kill -9 <PID>\n'
"netstat -tulnp | grep ':80'\n"
'fuser -k 80/tcp\n'
'exit\n'
'docker restart <container_id>\n'
'docker restart <container_id>\n'
'docker ps -a\n'
'docker ps -a\n'
'exit\n'
'docker stop <container_id>\n'
'docker ps -a\n'
'docker ps -a\n'
'exit\n'
'systemctl restart docker\n'
'exit\n'
'sudo systemctl restart docker\n'
'sudo reboot\n'
'pkill -f docker\n'
'sudo shutdown -r now\n'
'sudo reboot\n'
['asciinema rec --stdin /logs/tests.cast', 'Enter']
['clear', 'Enter']
['bash ', '/tests/run-tests.sh', 'Enter']
['C-d']
['C-d']
